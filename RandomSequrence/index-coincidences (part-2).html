<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Desk of cards, part 2</title>
    <style type="text/css">
        body, div {font: 11px Verdana;}
		input {position:absolute; top:1px; right:25px; padding:2px; width:30px;}
		button {position:absolute; top:1px; right:1px; width:24px; cursor: pointer;}
        div#case1 {position:absolute; top:0; left:0; width:45%;}
        div#case2 {position:absolute; top:0; left:50%; width:45%;}
    </style>

</head>

<body>
<div id="case1"></div>
<div id="case2"></div>
<script type="text/javascript">
// Coincidences (совпадения)

var part_1 = document.getElementById('case1');
var part_2 = document.getElementById('case2');

var cube = 6; // количество граней кубика

// заплатка: передаем количество граней
var get_cube = window.location.href.split('?');
if(get_cube[1]) { cube = parseInt(get_cube[1]); }
var form = document.createElement('form');
var inp = document.createElement('input');
var btn = document.createElement('button');
document.body.appendChild(form);
form.appendChild(inp);
form.appendChild(btn);
btn.innerHTML = ' &crarr; ';
inp.value = cube;
form.onsubmit = function(){
	window.location.href = get_cube[0] + '?' + inp.value;
	return false;
}
// конец заплатки


// создаем нормальное распределение случайных значений
// и выводим таблицу результатов
var div = document.createElement('div');
part_1.appendChild(div);
div.innerHTML = 'Случайные значения, выпавшие на <br>кубике ('+cube+' граней): ';

var arr1 = [];
for(var n=1; n<=1000; n++){
    arr1[n-1] = Math.floor(Math.random()*cube)+1; // броски
    var div = document.createElement('div');
    part_1.appendChild(div);
    div.innerHTML = (n<1000?"&nbsp;&nbsp;":"") + (n<100?"&nbsp;&nbsp;":"") + (n<10?"&nbsp;&nbsp;":"")
        + "<b>" + n + "</b>" + ". " + arr1[n-1];
}


var divG1 = document.createElement('div');
part_1.appendChild(divG1);
//divG1.innerHTML = '--------------------';


// определяем масксимальное случайное значение

var maxval = 0;
for(n=0; n<arr1.length; n++)
    if(arr1[n]>maxval)maxval=arr1[n];


// выполняем подсчет: сколько раз выпало каждое из значений
// и создаем массив результатов 

var div = document.createElement('div');
part_1.appendChild(div);
div.innerHTML = 'Подсчет количества одинаковых значений <br>('+cube+' граней): ';

var res1 = new Array(maxval+1); // исключаем нулевую ячейку
for(n=0; n<res1.length; n++)
    res1[n]=0;                  // предустанавливаем 0, исключая NaN
for(n=0; n<arr1.length; n++)
    res1[arr1[n]]++;            // суммируем выпавшие значения


// отображение результатов в форме таблицы

for(n=1; n<res1.length; n++){
    var div = document.createElement('div');
    part_1.appendChild(div);
    div.innerHTML = (n<100?"&nbsp;&nbsp;":"") + (n<10?"&nbsp;&nbsp;":"")
        + "<b>" + n + "</b>" + " - " + res1[n] + " " 
        + (res1[n]<100?"&nbsp;&nbsp;":"") + (res1[n]<10?"&nbsp;&nbsp;":"")
        + "/ рассчетное: " + Math.round(1/cube*arr1.length) + "";

}


// ------------------------------------------------------

// строим график для отображения распределения случайных величин
// так же выведем на график расчетные функции

// вызываем функцию, которая отображает массив на графике, выводя все значения

var mas = res1; // [0, 1, 3, 2];
var theory = []; // создаем массив теоретических значений значений

for(n=0; n<mas.length; n++){
    theory[n] = 1/cube * arr1.length;
}

// создаем холст и настраиваем параемтры вывода
var canvasID = document.createElement('canvas');
var contextID = canvasID.getContext('2d');
divG1.appendChild(canvasID);
canvasID.width = 290;
canvasID.height = 190;
canvasID.style.margin = '10px';

contextID.fillStyle = '#f0f0f0';
contextID.fillRect(0, 0, canvasID.width, canvasID.height);

// рамка холста
contextID.strokeStyle = '#000000';
contextID.lineWidth = 1;
contextID.beginPath();
contextID.rect(0.5, 0.5, canvasID.width-1, canvasID.height-1);
contextID.closePath();
contextID.stroke();


// рисуем координатные оси
var mX = 10;
var mY = 10;
contextID.lineWidth = 1;
contextID.beginPath();
contextID.moveTo(10.5+mX, mY);
contextID.lineTo(10.5+mX, canvasID.height-mY);
contextID.moveTo(mX, canvasID.height-10.5-mY);
contextID.lineTo(canvasID.width-mX, canvasID.height-10.5-mY);
contextID.strokeStyle = '#000';
contextID.stroke();

// рабочая область: 
// canvasID.width-2*mX-2*10 = 250 и 
// canvasID.height-2*mY-2*10 = 150


// проходим по массиву и выводим его значения в виде точек
// получаем диапазон значений
var maxX = mas.length;
var maxY = 0; for(n=0; n<mas.length; n++) if(mas[n]>maxY) maxY=mas[n];
// вычисляем коэффициенты масштабирования
var kX = (canvasID.width - 2*mX - 10)/maxX; /// = 250/1000
var kY = (canvasID.height - 2*mY - 2*10)/maxY; /// = 150/6
// обходим массив и рисуем точки
var xLast, yLast1, yLast2;
for(n=1; n<mas.length; n++){
    var x, y, r = 2;
    // отображаем теорию
    x = mX + 10.5 + n*kX;
    y = canvasID.height - (mY + 10.5 + theory[n]*kY);
    contextID.beginPath();
    contextID.arc(x, y, r, 0, 2*Math.PI, false);
    contextID.closePath();
    contextID.fillStyle = 'red';
    contextID.fill();
    if(n>1){
        contextID.beginPath();
        contextID.moveTo(xLast, yLast2);
        contextID.lineTo(x, y);
        contextID.closePath();
        contextID.strokeStyle = 'red';
        contextID.stroke();
    }
    yLast2 = y;
    // отображаем данные
    x = mX + 10.5 + n*kX;
    y = canvasID.height - (mY + 10.5 + mas[n]*kY);
    contextID.beginPath();
    contextID.arc(x, y, r, 0, 2*Math.PI, false);
    contextID.closePath();
    contextID.fillStyle = 'blue';
    contextID.fill();
    if(n>1){
        contextID.beginPath();
        contextID.moveTo(xLast, yLast1);
        contextID.lineTo(x, y);
        contextID.closePath();
        contextID.strokeStyle = 'blue';
        contextID.stroke();
    }
    yLast1 = y;
    xLast = x;
}


// ------------------------------------------------------


// создаем массив случайных значений - длин серий
// генерируем массив случайный значений для совпадений

var div = document.createElement('div');
part_2.appendChild(div);
div.innerHTML = 'Количество бросков от совпадения до <br>совпадения (повтор \'1\' из '+cube+'): ';

// функция получения серии
function throwDice(){
    for(var i=1; i<=1000; i++){
        var rnd = Math.floor(Math.random()*cube)+1;
        if(rnd==1) 
            return i;
    }
    return throwDice(); // если дина серии больше 1000, перезапустим ее
}


// генерирум последовательность серий, получая ряд числовых значений в массив

var arr2 = [];

for(var n=1; n<=1000; n++) {
    var div = document.createElement('div');
    part_2.appendChild(div);
    arr2[n-1] = throwDice();
    div.innerHTML = (n<1000?"&nbsp;&nbsp;":"") + (n<100?"&nbsp;&nbsp;":"") + (n<10?"&nbsp;&nbsp;":"")
        + "<b>" + n + "</b>" + ". " + arr2[n-1];
}


var divG2 = document.createElement('div');
part_2.appendChild(divG2);
//divG2.innerHTML += '--------------------';


// обрабатываем результаты: подсчитаем количество выпавших значений
// определяем масксимальное случайное значение (для создания таблицы результатов)

var div = document.createElement('div');
part_2.appendChild(div);
div.innerHTML = 'Подсчет количества одинаковых значений <br>(интервалов): ';

var maxval = 0;
for(n=0; n<arr2.length; n++)
    if(arr2[n]>maxval)maxval=arr2[n];


// создаем массив для хранения результатов, и заполним его

var res2 = [];
for(n=0; n<maxval+1; n++) 
    res2[n]=0;
for(n=0; n<arr2.length; n++)
    res2[arr2[n]]++;


// выводим таблицу результатов

for(n=1; n<res2.length; n++){
    var div = document.createElement('div');
    part_2.appendChild(div);
    div.innerHTML = (n<100?"&nbsp;&nbsp;":"") + (n<10?"&nbsp;&nbsp;":"")
        + "<b>" + n + "</b>" + " - " + res2[n] + " " 
        + (res2[n]<100?"&nbsp;&nbsp;":"") + (res2[n]<10?"&nbsp;&nbsp;":"")
        + "/ рассчетное: " + Math.round(1/(cube-1)*Math.pow((cube-1)/cube,n-1)*arr2.length) + "";
}



// ------------------------------------------------------


// строим график для отображения распределения случайных величин
// так же выведем на график расчетные функции

// вызываем функцию, которая отображает массив на графике, выводя все значения

var mas = res2; // [0, 1, 3, 2];
var theory = []; // создаем массив теоретических значений значений

theory[0] = 0;
for(n=1; n<mas.length; n++){
    theory[n] = 1/(cube-1) * Math.pow((cube-1)/cube, n-1) * arr2.length;
}

// создаем холст и настраиваем параемтры вывода
var canvasID = document.createElement('canvas');
var contextID = canvasID.getContext('2d');
divG2.appendChild(canvasID);
canvasID.width = 290;
canvasID.height = 190;
canvasID.style.margin = '10px';

contextID.fillStyle = '#f0f0f0';
contextID.fillRect(0, 0, canvasID.width, canvasID.height);

// рамка холста
contextID.strokeStyle = '#000000';
contextID.lineWidth = 1;
contextID.beginPath();
contextID.rect(0.5, 0.5, canvasID.width-1, canvasID.height-1);
contextID.closePath();
contextID.stroke();


// рисуем координатные оси
var mX = 10;
var mY = 10;
contextID.beginPath();
contextID.moveTo(10.5+mX, mY);
contextID.lineTo(10.5+mX, canvasID.height-mY);
contextID.moveTo(mX, canvasID.height-10.5-mY);
contextID.lineTo(canvasID.width-mX, canvasID.height-10.5-mY);
contextID.strokeStyle = '#000';
contextID.stroke();

// рабочая область: 
// canvasID.width-2*mX-2*10 = 250 и 
// canvasID.height-2*mY-2*10 = 150


// проходим по массиву и выводим его значения в виде точек
// получаем диапазон значений
var maxX = mas.length;
var maxY = 0;
for(n=0; n<mas.length; n++) if(mas[n]>maxY) maxY=mas[n];
for(n=0; n<theory.length; n++) if(theory[n]>maxY) maxY=theory[n];
// вычисляем коэффициенты масштабирования
var kX = (canvasID.width - 2*mX - 10)/maxX; /// = 250/1000
var kY = (canvasID.height - 2*mY - 2*10)/maxY; /// = 150/6
// обходим массив и рисуем точки
var xLast, yLast1, yLast2;
for(n=1; n<mas.length; n++){
    var x, y, r = 2;
    // отображаем теорию
    x = mX + 10.5 + n*kX;
    y = canvasID.height - (mY + 10.5 + theory[n]*kY);
    contextID.beginPath();
    contextID.arc(x, y, r, 0, 2*Math.PI, false);
    contextID.closePath();
    contextID.fillStyle = 'red';
    contextID.fill();
    if(n>1){
        contextID.beginPath();
        contextID.moveTo(xLast, yLast2);
        contextID.lineTo(x, y);
        contextID.closePath();
        contextID.strokeStyle = 'red';
        contextID.stroke();
    }
    yLast2 = y;
    // отображаем данные
    x = mX + 10.5 + n*kX;
    y = canvasID.height - (mY + 10.5 + mas[n]*kY);
    contextID.beginPath();
    contextID.arc(x, y, r, 0, 2*Math.PI, false);
    contextID.closePath();
    contextID.fillStyle = 'blue';
    contextID.fill();
    if(n>1){
        contextID.beginPath();
        contextID.moveTo(xLast, yLast1);
        contextID.lineTo(x, y);
        contextID.closePath();
        contextID.strokeStyle = 'blue';
        contextID.stroke();
    }
    yLast1 = y;
    xLast = x;
}


// ------------------------------------------------------


part_1.appendChild(document.createElement('br'));
part_2.appendChild(document.createElement('br'));

setTimeout(function(){
    divG1.scrollIntoView();
//    window.scrollTo(0, 999999);
}, 100);
</script>

</body>
</html>
